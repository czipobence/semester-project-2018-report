\section{Implementation/Architecture/Results}

We implemented the translation methods in \scalaInline{stainless.verification.CoqEncoder.scala} and  \scalaInline{stainless.verification.CoqExpression.scala}. The generated methods are written into temporary files, and coqc is invoked on them. For each function, a separate .v file is created, and each file contains all the dependencies of the function. For simplicity, we assumed a function depends on all ADT's and the functions it invokes directly or transitively. In order to speed verification and to eliminate a domino effect caused by one failing verification step, all obligations of the dependencies are admitted. The logic handling .v files can be found in \scalaInline{stainless.verification.CoqIO.scala}

In order to integrate our solution into the Stainless framework we replaced \scalaInline{VerificationChecker} with \scalaInline{CoqVerificationChecker}. It creates a verification condition for each method (file) and puts its result to the report. Because functions are verified individually, their verification can be canceled, or timeout can be defined for them.
%
In order to activate coq verification, a \scalaInline{--coq} flag has to be passed to stainless.

The tactics can be found in a separate slc-lib directory, where they have been separated based on their functionality. The tactics are included automatically into every generated file, however, before running the verification, the SLC module has to be generated by running make in the slc-lib directory.

To benchmark the translation and verification, it has been run on the Lists library with 5 minutes timeout (per function case). The results are summarized in Table~\ref{tab:res}. Out of 77 methods, 48 is valid, 9 is invalid (there are obligations remaining that the tactics can not solve) and 20 times out (most likely because looping rewrite of recursive functions).

\begin{table}[]
	\centering
	\caption{Verification results for the list library}
	\label{tab:res}
\begin{tabular}{lllllll}
\textbf{Function name} & \textbf{Status} & \textbf{Time} & & \textbf{Function name} & \textbf{Status} & \textbf{Time} \\
\&         & timeout & 300.002 &  & insertAtImpl  & invalid & 35.279  \\
++         & timeout & 300.003 &  & isDefined     & valid   & 2.005   \\
-          & timeout & 300.001 &  & isEmpty       & valid   & 2.004   \\
--         & timeout & 300.002 &  & isEmpty       & valid   & 1.972   \\
:+         & timeout & 300.017 &  & last          & valid   & 58.399  \\
::         & valid   & 2.04    &  & lastOption    & valid   & 4.262   \\
apply      & invalid & 7.736   &  & length        & valid   & 2.138   \\
chunk0     & invalid & 7.569   &  & map           & valid   & 5.812   \\
chunks     & valid   & 31.083  &  & map           & valid   & 2.342   \\
contains   & valid   & 7.43    &  & nonEmpty      & valid   & 1.903   \\
content    & valid   & 2.093   &  & nonEmpty      & valid   & 1.945   \\
count      & timeout & 300.012 &  & orElse        & valid   & 2.017   \\
drop       & timeout & 300.006 &  & padTo         & timeout & 300.005 \\
dropWhile  & timeout & 300.02  &  & partition     & timeout & 300.011 \\
empty      & valid   & 1.992   &  & replace       & timeout & 300.014 \\
evenSplit  & valid   & 28.316  &  & replaceAt     & invalid & 91.058  \\
exists     & valid   & 2.055   &  & replaceAtImpl & invalid & 49.727  \\
exists     & valid   & 1.99    &  & reverse       & timeout & 300.002 \\
filter     & timeout & 300.005 &  & rotate        & timeout & 300.001 \\
filter     & valid   & 2.069   &  & scanLeft      & valid   & 2.256   \\
filterNot  & timeout & 300.006 &  & scanRight     & valid   & 24.657  \\
find       & valid   & 6.975   &  & size          & valid   & 2.198   \\
flatMap    & valid   & 5.927   &  & slice         & valid   & 30.364  \\
flatMap    & valid   & 1.997   &  & split         & invalid & 3.786   \\
flatten    & valid   & 5.268   &  & splitAt       & valid   & 2.944   \\
foldLeft   & valid   & 2.206   &  & splitAtIndex  & timeout & 300.432 \\
foldRight  & valid   & 2.181   &  & tail          & valid   & 2.288   \\
forall     & valid   & 2.104   &  & tailOption    & valid   & 2.703   \\
forall     & valid   & 1.983   &  & tails         & valid   & 2.532   \\
get        & valid   & 2.167   &  & take          & timeout & 300.001 \\
getOrElse  & valid   & 2.01    &  & takeWhile     & timeout & 300.336 \\
groupBy    & valid   & 3.65    &  & toSet         & valid   & 2.282   \\
head       & valid   & 2.142   &  & toSet         & valid   & 2.063   \\
headOption & valid   & 2.126   &  & unique        & valid   & 3.191   \\
indexOf    & valid   & 178.239 &  & updated       & invalid & 33.731  \\
indexWhere & valid   & 185.303 &  & withFilter    & valid   & 278.839 \\
init       & timeout & 300.001 &  & withFilter    & valid   & 2.156   \\
insertAt   & invalid & 33.998  &  & zip           & timeout & 300.003 \\
insertAt   & invalid & 29.234  &  &               &         &        
\end{tabular}
\end{table}  